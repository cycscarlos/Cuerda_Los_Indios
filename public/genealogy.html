<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pedigrí Digital - Cuerda Los Indios</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/cart_modal.css" />
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>
  <body class="page-genealogy">
    <!-- Navbar Placeholder -->
    <nav id="navbar-placeholder" style="min-height: 80px"></nav>

    <header class="section text-center">
      <div class="container">
        <h1>Certificado de Pedigrí</h1>
        <p class="text-muted">Visualización interactiva del linaje.</p>
      </div>
    </header>

    <section class="section section-no-top">
      <div class="container">
        <!-- Details Card -->
        <div
          id="rooster-details"
          class="admin-panel"
          style="margin: 0 auto 2rem; text-align: center"
        >
          <h2 id="detail-name">Cargando...</h2>
          <p
            id="detail-strain"
            style="font-size: 1.2rem; color: #d4af37; font-weight: bold"
          >
            ...
          </p>
          <p>
            <strong>Placa:</strong> <span id="detail-plate">-</span> |
            <strong>Género:</strong> <span id="detail-gender">-</span>
          </p>
        </div>

        <!-- Tree Container -->
        <div
          id="tree-container"
          style="
            width: 100%;
            height: 500px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
          "
        ></div>

        <div class="text-center mt-lg">
          <a href="gallery.html" class="btn btn-secondary"
            >Volver a la Galería</a
          >
        </div>
      </div>
    </section>

    <!-- Footer Placeholder -->
    <footer id="footer-placeholder"></footer>

    <script type="module" src="js/main.js"></script>

    <script type="module">
      import ApiService from "./js/modules/ApiService.js";
      import GenealogyTree from "./js/modules/GenealogyTree.js";

      document.addEventListener("DOMContentLoaded", async () => {
        const api = new ApiService();
        const tree = new GenealogyTree("tree-container");

        // Get ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const roosterId = urlParams.get("id");

        try {
          if (roosterId) {
            // Fetch specific rooster
            // Note: In a real app we would have getRoosterById endpoint.
            // For now we fetch all and find one, or just render the whole tree if no ID.
            const roosters = await api.getRoosters();
            const rooster = roosters.find((r) => r.id == roosterId);

            if (rooster) {
              // Update Header Details
              document.getElementById("detail-name").textContent = rooster.name;
              document.getElementById("detail-strain").textContent =
                rooster.strain || "Linea Desconocida";
              document.getElementById("detail-plate").textContent =
                rooster.plate || "N/A";
              document.getElementById("detail-gender").textContent =
                rooster.gender;

              // Render Tree for this specific rooster
              // Note: The current GenealogyTree implementation seems to expect a list or specific format.
              // We will pass the single rooster object if the class supports it, or the whole list.
              // Based on previous code: tree.render(roosters) was passed ALL data.
              // Let's assume for this specific view we want to focus on one.
              // Ideally GenealogyTree module handles the logic of building ancestry from the list.
              tree.render(rooster);
            } else {
              document.getElementById("detail-name").textContent =
                "Ejemplar No Encontrado";
            }
          } else {
            document.getElementById("detail-name").textContent =
              "Seleccione un ejemplar desde la Galeria";
            // Optional: Render a demo tree or empty state
          }
        } catch (e) {
          console.error(e);
          document.getElementById(
            "tree-container"
          ).innerHTML = `<p class="text-danger text-center p-4">Error cargando datos: ${e.message}</p>`;
        }
      });
    </script>
  </body>
</html>
